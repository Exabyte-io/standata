{
    "_id": "7e376e1f-edf6-536b-9966-d274122dc799",
    "name": "Extract Bands Near Fermi",
    "application": {
        "name": "espresso"
    },
    "properties": [],
    "model": {
        "type": "unknown",
        "subtype": "unknown",
        "method": {
            "type": "pseudopotential",
            "subtype": "us",
            "data": {}
        }
    },
    "units": [
        {
            "name": "Init Band Structure",
            "type": "assignment",
            "operand": "band_structure",
            "value": "band_structure",
            "input": [],
            "flowchartId": "init-band-structure",
            "status": "idle",
            "statusTrack": [],
            "tags": [],
            "head": true,
            "next": "init-fermi-energy",
            "application": {
                "name": "espresso",
                "shortName": "qe",
                "summary": "Quantum ESPRESSO",
                "build": "GNU",
                "hasAdvancedComputeOptions": true,
                "isDefault": true,
                "version": "6.3",
                "schemaVersion": "2022.8.16"
            }
        },
        {
            "name": "Init Fermi Energy",
            "type": "assignment",
            "operand": "fermi_energy",
            "value": "fermi_energy",
            "input": [],
            "flowchartId": "init-fermi-energy",
            "status": "idle",
            "statusTrack": [],
            "tags": [],
            "head": false,
            "next": "extract-band-energies",
            "application": {
                "name": "espresso",
                "shortName": "qe",
                "summary": "Quantum ESPRESSO",
                "build": "GNU",
                "hasAdvancedComputeOptions": true,
                "isDefault": true,
                "version": "6.3",
                "schemaVersion": "2022.8.16"
            }
        },
        {
            "name": "Extract Band Energies",
            "type": "assignment",
            "operand": "band_energies",
            "value": "[band_data[0] for band_data in (band_structure['yDataSeries'] if 'yDataSeries' in band_structure else [])]",
            "input": [
                {
                    "name": "band_structure",
                    "scope": "init-band-structure"
                }
            ],
            "flowchartId": "extract-band-energies",
            "status": "idle",
            "statusTrack": [],
            "tags": [],
            "head": false,
            "next": "indices-below-fermi",
            "application": {
                "name": "espresso",
                "shortName": "qe",
                "summary": "Quantum ESPRESSO",
                "build": "GNU",
                "hasAdvancedComputeOptions": true,
                "isDefault": true,
                "version": "6.3",
                "schemaVersion": "2022.8.16"
            }
        },
        {
            "name": "Find Indices Below Fermi",
            "type": "assignment",
            "operand": "indices_below_fermi",
            "value": "[i for i in range(len(band_energies)) if band_energies[i] <= fermi_energy]",
            "input": [
                {
                    "name": "band_energies",
                    "scope": "extract-band-energies"
                },
                {
                    "name": "fermi_energy",
                    "scope": "init-fermi-energy"
                }
            ],
            "flowchartId": "indices-below-fermi",
            "status": "idle",
            "statusTrack": [],
            "tags": [],
            "head": false,
            "next": "indices-above-fermi",
            "application": {
                "name": "espresso",
                "shortName": "qe",
                "summary": "Quantum ESPRESSO",
                "build": "GNU",
                "hasAdvancedComputeOptions": true,
                "isDefault": true,
                "version": "6.3",
                "schemaVersion": "2022.8.16"
            }
        },
        {
            "name": "Find Indices Above Fermi",
            "type": "assignment",
            "operand": "indices_above_fermi",
            "value": "[i for i in range(len(band_energies)) if band_energies[i] > fermi_energy]",
            "input": [
                {
                    "name": "band_energies",
                    "scope": "extract-band-energies"
                },
                {
                    "name": "fermi_energy",
                    "scope": "init-fermi-energy"
                }
            ],
            "flowchartId": "indices-above-fermi",
            "status": "idle",
            "statusTrack": [],
            "tags": [],
            "head": false,
            "next": "8771dc7f-878e-5f13-a840-a3a416854f1e",
            "application": {
                "name": "espresso",
                "shortName": "qe",
                "summary": "Quantum ESPRESSO",
                "build": "GNU",
                "hasAdvancedComputeOptions": true,
                "isDefault": true,
                "version": "6.3",
                "schemaVersion": "2022.8.16"
            }
        },
        {
            "name": "Store Band Below EF",
            "type": "assignment",
            "operand": "KBAND_VALUE_BELOW_EF",
            "value": "indices_below_fermi[-1] + 1 if len(indices_below_fermi) > 0 else 1",
            "input": [
                {
                    "name": "indices_below_fermi",
                    "scope": "indices-below-fermi"
                }
            ],
            "status": "idle",
            "statusTrack": [],
            "flowchartId": "8771dc7f-878e-5f13-a840-a3a416854f1e",
            "tags": [],
            "head": false,
            "next": "91e1328f-39dd-5c24-83f9-d49bfe5c620e",
            "application": {
                "name": "espresso",
                "shortName": "qe",
                "summary": "Quantum ESPRESSO",
                "build": "GNU",
                "hasAdvancedComputeOptions": true,
                "isDefault": true,
                "version": "6.3",
                "schemaVersion": "2022.8.16"
            }
        },
        {
            "name": "Store Band Above EF",
            "type": "assignment",
            "operand": "KBAND_VALUE_ABOVE_EF",
            "value": "indices_above_fermi[0] + 1 if len(indices_above_fermi) > 0 else len(band_energies)",
            "input": [
                {
                    "name": "indices_above_fermi",
                    "scope": "indices-above-fermi"
                },
                {
                    "name": "band_energies",
                    "scope": "extract-band-energies"
                }
            ],
            "status": "idle",
            "statusTrack": [],
            "flowchartId": "91e1328f-39dd-5c24-83f9-d49bfe5c620e",
            "tags": [],
            "head": false,
            "next": "9fa08d2e-0ffd-5c12-8a88-086922fb3f72",
            "application": {
                "name": "espresso",
                "shortName": "qe",
                "summary": "Quantum ESPRESSO",
                "build": "GNU",
                "hasAdvancedComputeOptions": true,
                "isDefault": true,
                "version": "6.3",
                "schemaVersion": "2022.8.16"
            }
        },
        {
            "name": "Store Valence Energy",
            "type": "assignment",
            "operand": "VALENCE_ENERGY",
            "value": "band_energies[indices_below_fermi[-1]] if len(indices_below_fermi) > 0 else (band_energies[0] if len(band_energies) > 0 else 0.0)",
            "input": [
                {
                    "name": "band_energies",
                    "scope": "extract-band-energies"
                },
                {
                    "name": "indices_below_fermi",
                    "scope": "indices-below-fermi"
                }
            ],
            "status": "idle",
            "statusTrack": [],
            "flowchartId": "9fa08d2e-0ffd-5c12-8a88-086922fb3f72",
            "tags": [],
            "head": false,
            "next": "f5fbd236-2453-5ecd-aaf5-49940c45888c",
            "application": {
                "name": "espresso",
                "shortName": "qe",
                "summary": "Quantum ESPRESSO",
                "build": "GNU",
                "hasAdvancedComputeOptions": true,
                "isDefault": true,
                "version": "6.3",
                "schemaVersion": "2022.8.16"
            }
        },
        {
            "name": "Store Conduction Energy",
            "type": "assignment",
            "operand": "CONDUCTION_ENERGY",
            "value": "band_energies[indices_above_fermi[0]] if len(indices_above_fermi) > 0 else (band_energies[-1] if len(band_energies) > 0 else 0.0)",
            "input": [
                {
                    "name": "band_energies",
                    "scope": "extract-band-energies"
                },
                {
                    "name": "indices_above_fermi",
                    "scope": "indices-above-fermi"
                }
            ],
            "status": "idle",
            "statusTrack": [],
            "flowchartId": "f5fbd236-2453-5ecd-aaf5-49940c45888c",
            "tags": [],
            "head": false,
            "next": "fff25fab-985b-50c6-8b4c-db7f7adb29a8",
            "application": {
                "name": "espresso",
                "shortName": "qe",
                "summary": "Quantum ESPRESSO",
                "build": "GNU",
                "hasAdvancedComputeOptions": true,
                "isDefault": true,
                "version": "6.3",
                "schemaVersion": "2022.8.16"
            }
        },
        {
            "name": "Store Total Bands",
            "type": "assignment",
            "operand": "TOTAL_BANDS",
            "value": "len(band_energies)",
            "input": [
                {
                    "name": "band_energies",
                    "scope": "extract-band-energies"
                }
            ],
            "status": "idle",
            "statusTrack": [],
            "flowchartId": "fff25fab-985b-50c6-8b4c-db7f7adb29a8",
            "tags": [],
            "head": false,
            "next": "57a07d7d-3f68-5f31-97ad-ebe8c5593cd2",
            "application": {
                "name": "espresso",
                "shortName": "qe",
                "summary": "Quantum ESPRESSO",
                "build": "GNU",
                "hasAdvancedComputeOptions": true,
                "isDefault": true,
                "version": "6.3",
                "schemaVersion": "2022.8.16"
            }
        },
        {
            "name": "Select Band",
            "type": "assignment",
            "operand": "KBAND_VALUE",
            "value": "KBAND_VALUE_BELOW_EF",
            "input": [],
            "status": "idle",
            "statusTrack": [],
            "flowchartId": "57a07d7d-3f68-5f31-97ad-ebe8c5593cd2",
            "tags": [],
            "head": false,
            "application": {
                "name": "espresso",
                "shortName": "qe",
                "summary": "Quantum ESPRESSO",
                "build": "GNU",
                "hasAdvancedComputeOptions": true,
                "isDefault": true,
                "version": "6.3",
                "schemaVersion": "2022.8.16"
            }
        }
    ]
}
