{% if subworkflowContext.MATERIAL_INDEX %}
{%- set input = input.perMaterial[subworkflowContext.MATERIAL_INDEX] -%}
{% endif -%}
&CONTROL
    calculation = 'cp'
    restart_mode = '{{ input.RESTART_MODE }}'
    tstress = .true.
    tprnfor = .true.
    outdir = {% raw %}'{{ JOB_WORK_DIR }}'{% endraw %}
    prefix = 'cp'
    pseudo_dir = {% raw %}'{{ JOB_WORK_DIR }}/pseudo'{% endraw %}
    nstep = {{ dynamics.numberOfSteps }}
    iprint = 1
    dt = {{ dynamics.timeStep }}
/
&SYSTEM
    ibrav = {{ input.IBRAV }}
    nat = {{ input.NAT }}
    ntyp = {{ input.NTYP }}
    ecutwfc = {{ cutoffs.wavefunction }}
    ecutrho = {{ cutoffs.density }}
    nr1b = 20
    nr2b = 20
    nr3b = 20
/
&ELECTRONS
    electron_dynamics = 'verlet'
    electron_velocities = 'zero'
    emass = {{ dynamics.electronMass }}
!! consider the below parameters if orthogonalization fails
!   orthogonalization = 'ortho'
!   ortho_eps = 1d-11
/
&IONS
    ion_dynamics = 'verlet'
    ion_velocities = 'zero'
    tempw = {{ dynamics.temperature }}
/
&CELL
/
ATOMIC_SPECIES
{% for specie in input.ATOMIC_SPECIES -%}
{{ specie.X }} {{ specie.Mass_X|sprintf("%f") }} {{ specie.PseudoPot_X }}
{% endfor %}
ATOMIC_POSITIONS crystal
{%- set print_constrnts = false %}{%- for position in input.ATOMIC_POSITIONS %}{% if position["if_pos(1)"] != 1 or position["if_pos(2)"] != 1 or position["if_pos(3)"] != 1 %}{%- set print_constrnts = true %}{% endif %}{%- endfor %}
{%- for position in input.ATOMIC_POSITIONS -%}
{{ position.X|sprintf("%-3s") }} {{ position.x|sprintf("%14.9f") }} {{ position.y|sprintf("%14.9f") }} {{ position.z|sprintf("%14.9f") }}{% if print_constraints %} {{ position["if_pos(1)"] }} {{ position["if_pos(2)"] }} {{ position["if_pos(3)"] }}{% endif %}
{% endfor %}
CELL_PARAMETERS angstrom
{{ input.CELL_PARAMETERS.v1[0]|sprintf("%14.9f") }} {{ input.CELL_PARAMETERS.v1[1]|sprintf("%14.9f") }} {{ input.CELL_PARAMETERS.v1[2]|sprintf("%14.9f") }}
{{ input.CELL_PARAMETERS.v2[0]|sprintf("%14.9f") }} {{ input.CELL_PARAMETERS.v2[1]|sprintf("%14.9f") }} {{ input.CELL_PARAMETERS.v2[2]|sprintf("%14.9f") }}
{{ input.CELL_PARAMETERS.v3[0]|sprintf("%14.9f") }} {{ input.CELL_PARAMETERS.v3[1]|sprintf("%14.9f") }} {{ input.CELL_PARAMETERS.v3[2]|sprintf("%14.9f") }}
