{
    "name": "Wavefunction Plot",
    "subworkflows": [
        {
            "_id": "109ac366-8f6d-56d5-9b45-6f665f13a511",
            "name": "Total Energy with Bands",
            "application": {
                "name": "espresso",
                "shortName": "qe",
                "summary": "Quantum ESPRESSO",
                "build": "GNU",
                "hasAdvancedComputeOptions": true,
                "isDefault": true,
                "version": "6.3",
                "schemaVersion": "2022.8.16"
            },
            "properties": [
                "atomic_forces",
                "fermi_energy",
                "pressure",
                "stress_tensor",
                "total_energy",
                "total_energy_contributions",
                "total_force",
                "band_structure"
            ],
            "model": {
                "type": "dft",
                "subtype": "gga",
                "method": {
                    "type": "pseudopotential",
                    "subtype": "us",
                    "data": {}
                },
                "functional": {
                    "slug": "pbe"
                },
                "refiners": [],
                "modifiers": []
            },
            "units": [
                {
                    "type": "execution",
                    "name": "pw_scf",
                    "head": true,
                    "results": [
                        {
                            "name": "atomic_forces"
                        },
                        {
                            "name": "fermi_energy"
                        },
                        {
                            "name": "pressure"
                        },
                        {
                            "name": "stress_tensor"
                        },
                        {
                            "name": "total_energy"
                        },
                        {
                            "name": "total_energy_contributions"
                        },
                        {
                            "name": "total_force"
                        }
                    ],
                    "monitors": [
                        {
                            "name": "standard_output"
                        },
                        {
                            "name": "convergence_electronic"
                        }
                    ],
                    "flowchartId": "pw-scf-total-energy",
                    "preProcessors": [],
                    "postProcessors": [],
                    "application": {
                        "name": "espresso",
                        "shortName": "qe",
                        "summary": "Quantum ESPRESSO",
                        "build": "GNU",
                        "hasAdvancedComputeOptions": true,
                        "isDefault": true,
                        "version": "6.3",
                        "schemaVersion": "2022.8.16"
                    },
                    "executable": {
                        "hasAdvancedComputeOptions": true,
                        "isDefault": true,
                        "monitors": [
                            "standard_output",
                            "convergence_ionic",
                            "convergence_electronic"
                        ],
                        "postProcessors": [
                            "remove_non_zero_weight_kpoints"
                        ],
                        "name": "pw.x",
                        "schemaVersion": "2022.8.16"
                    },
                    "flavor": {
                        "applicationName": "espresso",
                        "executableName": "pw.x",
                        "input": [
                            {
                                "name": "pw_scf.in"
                            }
                        ],
                        "isDefault": true,
                        "monitors": [
                            "standard_output",
                            "convergence_electronic"
                        ],
                        "results": [
                            "atomic_forces",
                            "fermi_energy",
                            "pressure",
                            "stress_tensor",
                            "total_energy",
                            "total_energy_contributions",
                            "total_force"
                        ],
                        "name": "pw_scf",
                        "schemaVersion": "2022.8.16"
                    },
                    "status": "idle",
                    "statusTrack": [],
                    "tags": [],
                    "input": [
                        {
                            "applicationName": "espresso",
                            "content": "{% if subworkflowContext.MATERIAL_INDEX %}\n{%- set input = input.perMaterial[subworkflowContext.MATERIAL_INDEX] -%}\n{% endif -%}\n&CONTROL\n    calculation = 'scf'\n    title = ''\n    verbosity = 'low'\n    restart_mode = '{{ input.RESTART_MODE }}'\n    wf_collect = .true.\n    tstress = .true.\n    tprnfor = .true.\n    outdir = {% raw %}'{{ JOB_WORK_DIR }}/outdir'{% endraw %}\n    wfcdir = {% raw %}'{{ JOB_WORK_DIR }}/outdir'{% endraw %}\n    prefix = '__prefix__'\n    pseudo_dir = {% raw %}'{{ JOB_WORK_DIR }}/pseudo'{% endraw %}\n/\n&SYSTEM\n    ibrav = {{ input.IBRAV }}\n    nat = {{ input.NAT }}\n    ntyp = {{ input.NTYP }}\n    ecutwfc = {{ cutoffs.wavefunction }}\n    ecutrho = {{ cutoffs.density }}\n    occupations = 'smearing'\n    degauss = 0.005\n/\n&ELECTRONS\n    diagonalization = 'david'\n    diago_david_ndim = 4\n    diago_full_acc = .true.\n    mixing_beta = 0.3\n    startingwfc = 'atomic+random'\n/\n&IONS\n/\n&CELL\n/\nATOMIC_SPECIES\n{{ input.ATOMIC_SPECIES }}\nATOMIC_POSITIONS crystal\n{{ input.ATOMIC_POSITIONS }}\nCELL_PARAMETERS angstrom\n{{ input.CELL_PARAMETERS }}\nK_POINTS automatic\n{% for d in kgrid.dimensions %}{{d}} {% endfor %}{% for s in kgrid.shifts %}{{s}} {% endfor %}\n",
                            "contextProviders": [
                                {
                                    "name": "KGridFormDataManager"
                                },
                                {
                                    "name": "QEPWXInputDataManager"
                                },
                                {
                                    "name": "PlanewaveCutoffDataManager"
                                }
                            ],
                            "executableName": "pw.x",
                            "name": "pw_scf.in",
                            "rendered": "&CONTROL\n    calculation = 'scf'\n    title = ''\n    verbosity = 'low'\n    restart_mode = 'from_scratch'\n    wf_collect = .true.\n    tstress = .true.\n    tprnfor = .true.\n    outdir = '{{ JOB_WORK_DIR }}/outdir'\n    wfcdir = '{{ JOB_WORK_DIR }}/outdir'\n    prefix = '__prefix__'\n    pseudo_dir = '{{ JOB_WORK_DIR }}/pseudo'\n/\n&SYSTEM\n    ibrav = 0\n    nat = 2\n    ntyp = 1\n    ecutwfc = 40\n    ecutrho = 200\n    occupations = 'smearing'\n    degauss = 0.005\n/\n&ELECTRONS\n    diagonalization = 'david'\n    diago_david_ndim = 4\n    diago_full_acc = .true.\n    mixing_beta = 0.3\n    startingwfc = 'atomic+random'\n/\n&IONS\n/\n&CELL\n/\nATOMIC_SPECIES\nSi 28.0855 \nATOMIC_POSITIONS crystal\nSi     0.000000000    0.000000000    0.000000000 \nSi     0.250000000    0.250000000    0.250000000 \nCELL_PARAMETERS angstrom\n3.348920236 0.000000000 1.933500000\n1.116306745 3.157392278 1.933500000\n0.000000000 0.000000000 3.867000000\nK_POINTS automatic\n2 2 2 0 0 0 \n",
                            "schemaVersion": "2022.8.16"
                        }
                    ],
                    "next": "pw-bands-total-energy"
                },
                {
                    "type": "execution",
                    "name": "pw_bands",
                    "head": false,
                    "results": [
                        {
                            "name": "band_structure"
                        }
                    ],
                    "monitors": [
                        {
                            "name": "standard_output"
                        }
                    ],
                    "flowchartId": "pw-bands-total-energy",
                    "preProcessors": [],
                    "postProcessors": [],
                    "application": {
                        "name": "espresso",
                        "shortName": "qe",
                        "summary": "Quantum ESPRESSO",
                        "build": "GNU",
                        "hasAdvancedComputeOptions": true,
                        "isDefault": true,
                        "version": "6.3",
                        "schemaVersion": "2022.8.16"
                    },
                    "executable": {
                        "hasAdvancedComputeOptions": true,
                        "isDefault": true,
                        "monitors": [
                            "standard_output",
                            "convergence_ionic",
                            "convergence_electronic"
                        ],
                        "postProcessors": [
                            "remove_non_zero_weight_kpoints"
                        ],
                        "name": "pw.x",
                        "schemaVersion": "2022.8.16"
                    },
                    "flavor": {
                        "applicationName": "espresso",
                        "executableName": "pw.x",
                        "input": [
                            {
                                "name": "pw_bands.in"
                            }
                        ],
                        "monitors": [
                            "standard_output"
                        ],
                        "results": [
                            "band_structure"
                        ],
                        "name": "pw_bands",
                        "schemaVersion": "2022.8.16",
                        "isDefault": false
                    },
                    "status": "idle",
                    "statusTrack": [],
                    "tags": [],
                    "input": [
                        {
                            "applicationName": "espresso",
                            "content": "{% if subworkflowContext.MATERIAL_INDEX %}\n{%- set input = input.perMaterial[subworkflowContext.MATERIAL_INDEX] -%}\n{% endif -%}\n&CONTROL\n    calculation = 'bands'\n    title = ''\n    verbosity = 'low'\n    restart_mode = '{{input.RESTART_MODE}}'\n    wf_collect = .true.\n    tstress = .true.\n    tprnfor = .true.\n    outdir = {% raw %}'{{ JOB_WORK_DIR }}/outdir'{% endraw %}\n    wfcdir = {% raw %}'{{ JOB_WORK_DIR }}/outdir'{% endraw %}\n    prefix = '__prefix__'\n    pseudo_dir = {% raw %}'{{ JOB_WORK_DIR }}/pseudo'{% endraw %}\n/\n&SYSTEM\n    ibrav = {{ input.IBRAV }}\n    nat = {{ input.NAT }}\n    ntyp = {{ input.NTYP }}\n    ecutwfc = {{ cutoffs.wavefunction }}\n    ecutrho = {{ cutoffs.density }}\n    occupations = 'smearing'\n    degauss = 0.005\n/\n&ELECTRONS\n    diagonalization = 'david'\n    diago_david_ndim = 4\n    diago_full_acc = .true.\n    mixing_beta = 0.3\n/\n&IONS\n/\n&CELL\n/\nATOMIC_SPECIES\n{{ input.ATOMIC_SPECIES }}\nATOMIC_POSITIONS crystal\n{{ input.ATOMIC_POSITIONS }}\nCELL_PARAMETERS angstrom\n{{ input.CELL_PARAMETERS }}\nK_POINTS crystal_b\n{{kpath.length}}\n{% for point in kpath -%}\n{% for d in point.coordinates %}{{d}} {% endfor -%}{{point.steps}}\n{% endfor %}\n",
                            "contextProviders": [
                                {
                                    "name": "KPathFormDataManager"
                                },
                                {
                                    "name": "QEPWXInputDataManager"
                                },
                                {
                                    "name": "PlanewaveCutoffDataManager"
                                }
                            ],
                            "executableName": "pw.x",
                            "name": "pw_bands.in",
                            "rendered": "&CONTROL\n    calculation = 'bands'\n    title = ''\n    verbosity = 'low'\n    restart_mode = 'from_scratch'\n    wf_collect = .true.\n    tstress = .true.\n    tprnfor = .true.\n    outdir = '{{ JOB_WORK_DIR }}/outdir'\n    wfcdir = '{{ JOB_WORK_DIR }}/outdir'\n    prefix = '__prefix__'\n    pseudo_dir = '{{ JOB_WORK_DIR }}/pseudo'\n/\n&SYSTEM\n    ibrav = 0\n    nat = 2\n    ntyp = 1\n    ecutwfc = 40\n    ecutrho = 200\n    occupations = 'smearing'\n    degauss = 0.005\n/\n&ELECTRONS\n    diagonalization = 'david'\n    diago_david_ndim = 4\n    diago_full_acc = .true.\n    mixing_beta = 0.3\n/\n&IONS\n/\n&CELL\n/\nATOMIC_SPECIES\nSi 28.0855 \nATOMIC_POSITIONS crystal\nSi     0.000000000    0.000000000    0.000000000 \nSi     0.250000000    0.250000000    0.250000000 \nCELL_PARAMETERS angstrom\n3.348920236 0.000000000 1.933500000\n1.116306745 3.157392278 1.933500000\n0.000000000 0.000000000 3.867000000\nK_POINTS crystal_b\n11\n   0.000000000    0.000000000    0.000000000 10\n   0.500000000    0.000000000    0.500000000 10\n   0.500000000    0.250000000    0.750000000 10\n   0.375000000    0.375000000    0.750000000 10\n   0.000000000    0.000000000    0.000000000 10\n   0.500000000    0.500000000    0.500000000 10\n   0.625000000    0.250000000    0.625000000 10\n   0.500000000    0.250000000    0.750000000 10\n   0.500000000    0.500000000    0.500000000 10\n   0.625000000    0.250000000    0.625000000 10\n   0.500000000    0.000000000    0.500000000 10\n\n",
                            "schemaVersion": "2022.8.16"
                        }
                    ],
                    "next": "18a26058-7d37-57ac-a685-335862dbf4db"
                },
                {
                    "name": "assignment BS",
                    "type": "assignment",
                    "operand": "band_structure",
                    "value": "band_structure",
                    "input": [
                        {
                            "name": "band_structure",
                            "scope": "pw-bands-total-energy"
                        }
                    ],
                    "status": "idle",
                    "statusTrack": [],
                    "flowchartId": "18a26058-7d37-57ac-a685-335862dbf4db",
                    "tags": [],
                    "head": false,
                    "next": "7d103bf9-40b8-5f90-8934-bbcb6c7b9802",
                    "application": {
                        "name": "espresso",
                        "shortName": "qe",
                        "summary": "Quantum ESPRESSO",
                        "build": "GNU",
                        "hasAdvancedComputeOptions": true,
                        "isDefault": true,
                        "version": "6.3",
                        "schemaVersion": "2022.8.16"
                    }
                },
                {
                    "name": "assignment FE",
                    "type": "assignment",
                    "operand": "fermi_energy",
                    "value": "fermi_energy",
                    "input": [
                        {
                            "name": "fermi_energy",
                            "scope": "pw-scf-total-energy"
                        }
                    ],
                    "status": "idle",
                    "statusTrack": [],
                    "flowchartId": "7d103bf9-40b8-5f90-8934-bbcb6c7b9802",
                    "tags": [],
                    "head": false,
                    "application": {
                        "name": "espresso",
                        "shortName": "qe",
                        "summary": "Quantum ESPRESSO",
                        "build": "GNU",
                        "hasAdvancedComputeOptions": true,
                        "isDefault": true,
                        "version": "6.3",
                        "schemaVersion": "2022.8.16"
                    }
                }
            ]
        },
        {
            "unitConfigs": [
                {
                    "index": 0,
                    "type": "executionBuilder",
                    "config": {
                        "attributes": {
                            "input": [
                                {
                                    "name": "band_structure",
                                    "scope": "total_energy_with_bands"
                                },
                                {
                                    "name": "fermi_energy",
                                    "scope": "total_energy_with_bands"
                                }
                            ]
                        }
                    }
                },
                {
                    "index": 3,
                    "type": "assignment",
                    "config": {
                        "attributes": {
                            "input": [
                                {
                                    "name": "KBAND_VALUE_BELOW_EF"
                                },
                                {
                                    "name": "KBAND_VALUE_ABOVE_EF"
                                }
                            ]
                        }
                    }
                }
            ],
            "_id": "1bb75a6a-4c8c-5336-a24c-1963e83825bc",
            "name": "Extract Bands Near Fermi",
            "application": {
                "name": "python",
                "shortName": "py",
                "summary": "Python Script",
                "build": "GNU",
                "isDefault": true,
                "version": "3.10.13",
                "schemaVersion": "2022.8.16"
            },
            "properties": [],
            "model": {
                "type": "unknown",
                "subtype": "unknown",
                "method": {
                    "type": "unknown",
                    "subtype": "unknown",
                    "data": {}
                }
            },
            "units": [
                {
                    "type": "execution",
                    "name": "extract_bands_fermi",
                    "head": true,
                    "results": [],
                    "monitors": [
                        {
                            "name": "standard_output"
                        }
                    ],
                    "flowchartId": "extract-band-fermi",
                    "preProcessors": [],
                    "postProcessors": [],
                    "application": {
                        "name": "python",
                        "shortName": "py",
                        "summary": "Python Script",
                        "build": "GNU",
                        "isDefault": true,
                        "version": "3.10.13",
                        "schemaVersion": "2022.8.16"
                    },
                    "executable": {
                        "isDefault": true,
                        "monitors": [
                            "standard_output"
                        ],
                        "name": "python",
                        "schemaVersion": "2022.8.16"
                    },
                    "flavor": {
                        "applicationName": "python",
                        "executableName": "python",
                        "input": [
                            {
                                "name": "extract_bands_fermi.py"
                            },
                            {
                                "name": "requirements.txt",
                                "templateName": "requirements_bands_fermi.txt"
                            }
                        ],
                        "monitors": [
                            "standard_output"
                        ],
                        "name": "extract_bands_fermi",
                        "schemaVersion": "2022.8.16",
                        "isDefault": false
                    },
                    "status": "idle",
                    "statusTrack": [],
                    "tags": [],
                    "input": [
                        {
                            "applicationName": "python",
                            "content": "# ---------------------------------------------------------------- #\n# Extract band indices near Fermi energy from band_structure       #\n# This script expects fermi_energy and band_structure results      #\n# ---------------------------------------------------------------- #\nimport json\n\nfrom munch import Munch\n\n# Data From Context\n# -----------------\n# fermi_energy: float (in eV) - from pw_scf result\n# band_structure: Munch object with band energies - from pw_bands result\n\n{% raw %}fermi_energy_value = {{ fermi_energy }}{% endraw %}\n{% raw %}band_structure_data = {{ band_structure }}{% endraw %}\n\n# Extract band energies at Gamma point (first k-point)\n# band_structure format from QE parser:\n# {\n#   \"name\": \"band_structure\",\n#   \"xDataArray\": [[kx, ky, kz], ...],  # k-points\n#   \"yDataSeries\": [[e1_k1, e1_k2, ...], [e2_k1, e2_k2, ...], ...]  # energies per band\n# }\n# yDataSeries[band_index][kpoint_index] = energy\n\n# Get energies at first k-point (Gamma, index 0) for all bands\ny_data = band_structure_data.get('yDataSeries', [])\nband_energies = [band_data[0] for band_data in y_data] if y_data else []\n\n# Find bands near Fermi energy (1-based indices as QE expects)\nvalence_bands = [(i + 1, e) for i, e in enumerate(band_energies) if e <= fermi_energy_value]\nconduction_bands = [(i + 1, e) for i, e in enumerate(band_energies) if e > fermi_energy_value]\n\nif valence_bands:\n    valence_index, valence_energy = max(valence_bands, key=lambda x: x[1])\nelse:\n    valence_index = 1\n    valence_energy = band_energies[0] if band_energies else 0.0\n\nif conduction_bands:\n    conduction_index, conduction_energy = min(conduction_bands, key=lambda x: x[1])\nelse:\n    conduction_index = len(band_energies)\n    conduction_energy = band_energies[-1] if band_energies else 0.0\n\nresult = {\n    \"band_below_fermi\": valence_index,\n    \"band_above_fermi\": conduction_index,\n    \"fermi_energy\": fermi_energy_value,\n    \"valence_energy\": valence_energy,\n    \"conduction_energy\": conduction_energy,\n    \"total_bands\": len(band_energies)\n}\n\n# Print to STDOUT for subsequent assignment unit\nprint(json.dumps(result, indent=4))\n",
                            "contextProviders": [],
                            "executableName": "python",
                            "name": "extract_bands_fermi.py",
                            "rendered": "# ---------------------------------------------------------------- #\n# Extract band indices near Fermi energy from band_structure       #\n# This script expects fermi_energy and band_structure results      #\n# ---------------------------------------------------------------- #\nimport json\n\nfrom munch import Munch\n\n# Data From Context\n# -----------------\n# fermi_energy: float (in eV) - from pw_scf result\n# band_structure: Munch object with band energies - from pw_bands result\n\nfermi_energy_value = {{ fermi_energy }}\nband_structure_data = {{ band_structure }}\n\n# Extract band energies at Gamma point (first k-point)\n# band_structure format from QE parser:\n# {\n#   \"name\": \"band_structure\",\n#   \"xDataArray\": [[kx, ky, kz], ...],  # k-points\n#   \"yDataSeries\": [[e1_k1, e1_k2, ...], [e2_k1, e2_k2, ...], ...]  # energies per band\n# }\n# yDataSeries[band_index][kpoint_index] = energy\n\n# Get energies at first k-point (Gamma, index 0) for all bands\ny_data = band_structure_data.get('yDataSeries', [])\nband_energies = [band_data[0] for band_data in y_data] if y_data else []\n\n# Find bands near Fermi energy (1-based indices as QE expects)\nvalence_bands = [(i + 1, e) for i, e in enumerate(band_energies) if e <= fermi_energy_value]\nconduction_bands = [(i + 1, e) for i, e in enumerate(band_energies) if e > fermi_energy_value]\n\nif valence_bands:\n    valence_index, valence_energy = max(valence_bands, key=lambda x: x[1])\nelse:\n    valence_index = 1\n    valence_energy = band_energies[0] if band_energies else 0.0\n\nif conduction_bands:\n    conduction_index, conduction_energy = min(conduction_bands, key=lambda x: x[1])\nelse:\n    conduction_index = len(band_energies)\n    conduction_energy = band_energies[-1] if band_energies else 0.0\n\nresult = {\n    \"band_below_fermi\": valence_index,\n    \"band_above_fermi\": conduction_index,\n    \"fermi_energy\": fermi_energy_value,\n    \"valence_energy\": valence_energy,\n    \"conduction_energy\": conduction_energy,\n    \"total_bands\": len(band_energies)\n}\n\n# Print to STDOUT for subsequent assignment unit\nprint(json.dumps(result, indent=4))\n",
                            "schemaVersion": "2022.8.16"
                        },
                        {
                            "applicationName": "python",
                            "content": "# ------------------------------------------------------------------ #\n#                                                                    #\n#  Python package requirements for extract_bands_fermi unit          #\n#                                                                    #\n# ------------------------------------------------------------------ #\n\nmunch==2.5.0\n",
                            "contextProviders": [],
                            "executableName": "python",
                            "name": "requirements.txt",
                            "rendered": "# ------------------------------------------------------------------ #\n#                                                                    #\n#  Python package requirements for extract_bands_fermi unit          #\n#                                                                    #\n# ------------------------------------------------------------------ #\n\nmunch==2.5.0\n",
                            "schemaVersion": "2022.8.16"
                        }
                    ],
                    "next": "8771dc7f-878e-5f13-a840-a3a416854f1e"
                },
                {
                    "name": "Store Band Below EF",
                    "type": "assignment",
                    "operand": "KBAND_VALUE_BELOW_EF",
                    "value": "json.loads(STDOUT)['band_below_fermi']",
                    "input": [
                        {
                            "name": "STDOUT",
                            "scope": "extract-band-fermi"
                        }
                    ],
                    "status": "idle",
                    "statusTrack": [],
                    "flowchartId": "8771dc7f-878e-5f13-a840-a3a416854f1e",
                    "tags": [],
                    "head": false,
                    "next": "91e1328f-39dd-5c24-83f9-d49bfe5c620e",
                    "application": {
                        "name": "python",
                        "shortName": "py",
                        "summary": "Python Script",
                        "build": "GNU",
                        "isDefault": true,
                        "version": "3.10.13",
                        "schemaVersion": "2022.8.16"
                    }
                },
                {
                    "name": "Store Band Above EF",
                    "type": "assignment",
                    "operand": "KBAND_VALUE_ABOVE_EF",
                    "value": "json.loads(STDOUT)['band_above_fermi']",
                    "input": [
                        {
                            "name": "STDOUT",
                            "scope": "extract-band-fermi"
                        }
                    ],
                    "status": "idle",
                    "statusTrack": [],
                    "flowchartId": "91e1328f-39dd-5c24-83f9-d49bfe5c620e",
                    "tags": [],
                    "head": false,
                    "next": "57a07d7d-3f68-5f31-97ad-ebe8c5593cd2",
                    "application": {
                        "name": "python",
                        "shortName": "py",
                        "summary": "Python Script",
                        "build": "GNU",
                        "isDefault": true,
                        "version": "3.10.13",
                        "schemaVersion": "2022.8.16"
                    }
                },
                {
                    "name": "Select Band",
                    "type": "assignment",
                    "operand": "KBAND_VALUE",
                    "value": "KBAND_VALUE_BELOW_EF",
                    "input": [],
                    "status": "idle",
                    "statusTrack": [],
                    "flowchartId": "57a07d7d-3f68-5f31-97ad-ebe8c5593cd2",
                    "tags": [],
                    "head": false,
                    "application": {
                        "name": "python",
                        "shortName": "py",
                        "summary": "Python Script",
                        "build": "GNU",
                        "isDefault": true,
                        "version": "3.10.13",
                        "schemaVersion": "2022.8.16"
                    }
                }
            ]
        },
        {
            "unitConfigs": [
                {
                    "index": 0,
                    "type": "executionBuilder",
                    "config": {
                        "attributes": {
                            "input": [
                                {
                                    "name": "KBAND_VALUE",
                                    "scope": "extract_bands_fermi"
                                }
                            ]
                        }
                    }
                }
            ],
            "_id": "7edc20aa-d533-57d8-b8a0-1e504ceb19fd",
            "name": "PP Wavefunction",
            "application": {
                "name": "espresso",
                "shortName": "qe",
                "summary": "Quantum ESPRESSO",
                "build": "GNU",
                "hasAdvancedComputeOptions": true,
                "isDefault": true,
                "version": "6.3",
                "schemaVersion": "2022.8.16"
            },
            "properties": [],
            "model": {
                "type": "dft",
                "subtype": "gga",
                "method": {
                    "type": "pseudopotential",
                    "subtype": "us",
                    "data": {}
                },
                "functional": {
                    "slug": "pbe"
                },
                "refiners": [],
                "modifiers": []
            },
            "units": [
                {
                    "type": "execution",
                    "name": "pp_wfn",
                    "head": true,
                    "results": [],
                    "monitors": [
                        {
                            "name": "standard_output"
                        }
                    ],
                    "flowchartId": "pp-wfn",
                    "preProcessors": [],
                    "postProcessors": [],
                    "application": {
                        "name": "espresso",
                        "shortName": "qe",
                        "summary": "Quantum ESPRESSO",
                        "build": "GNU",
                        "hasAdvancedComputeOptions": true,
                        "isDefault": true,
                        "version": "6.3",
                        "schemaVersion": "2022.8.16"
                    },
                    "executable": {
                        "monitors": [
                            "standard_output"
                        ],
                        "name": "pp.x",
                        "schemaVersion": "2022.8.16",
                        "isDefault": false
                    },
                    "flavor": {
                        "applicationName": "espresso",
                        "executableName": "pp.x",
                        "input": [
                            {
                                "name": "pp_wfn.in"
                            }
                        ],
                        "monitors": [
                            "standard_output"
                        ],
                        "results": [],
                        "name": "pp_wfn",
                        "schemaVersion": "2022.8.16",
                        "isDefault": false
                    },
                    "status": "idle",
                    "statusTrack": [],
                    "tags": [],
                    "input": [
                        {
                            "applicationName": "espresso",
                            "content": "&INPUTPP\n    outdir = {% raw %}'{{ JOB_WORK_DIR }}/outdir'{% endraw %}\n    prefix = '__prefix__'\n    plot_num       = 7,\n    kpoint         = 1,\n    kband          = {% raw %}{{ KBAND_VALUE }}{% endraw %},\n    lsign          = .true.,\n    !spin_component = 1\n/\n&PLOT\n    iflag = 1,          ! 1D line (not 2D plane)\n    fileout = 'wf_r.dat',\n    output_format = 0,  ! gnuplot 1D\n    x0(1)=0.0, x0(2)=0.0, x0(3)=0.0,   ! line origin (alat units)\n    e1(1)=0.0, e1(2)=0.0, e1(3)=1.0,   ! direction along z (alat units)\n    nx = 200                           ! samples along the line\n/\n",
                            "contextProviders": [],
                            "executableName": "pp.x",
                            "name": "pp_wfn.in",
                            "rendered": "&INPUTPP\n    outdir = '{{ JOB_WORK_DIR }}/outdir'\n    prefix = '__prefix__'\n    plot_num       = 7,\n    kpoint         = 1,\n    kband          = {{ KBAND_VALUE }},\n    lsign          = .true.,\n    !spin_component = 1\n/\n&PLOT\n    iflag = 1,          ! 1D line (not 2D plane)\n    fileout = 'wf_r.dat',\n    output_format = 0,  ! gnuplot 1D\n    x0(1)=0.0, x0(2)=0.0, x0(3)=0.0,   ! line origin (alat units)\n    e1(1)=0.0, e1(2)=0.0, e1(3)=1.0,   ! direction along z (alat units)\n    nx = 200                           ! samples along the line\n/\n",
                            "schemaVersion": "2022.8.16"
                        }
                    ]
                }
            ]
        },
        {
            "_id": "e4ec581f-1cb3-5036-b698-999a96711559",
            "name": "Plot Wavefunction",
            "application": {
                "name": "python",
                "shortName": "py",
                "summary": "Python Script",
                "build": "GNU",
                "isDefault": true,
                "version": "3.10.13",
                "schemaVersion": "2022.8.16"
            },
            "properties": [
                "potential_profile",
                "file_content"
            ],
            "model": {
                "type": "unknown",
                "subtype": "unknown",
                "method": {
                    "type": "unknown",
                    "subtype": "unknown",
                    "data": {}
                }
            },
            "units": [
                {
                    "type": "execution",
                    "name": "plot WFN",
                    "head": true,
                    "results": [
                        {
                            "name": "potential_profile"
                        },
                        {
                            "name": "file_content"
                        }
                    ],
                    "monitors": [
                        {
                            "name": "standard_output"
                        }
                    ],
                    "flowchartId": "57fca898-8e8b-5ef2-81a5-9d2b612bc18d",
                    "preProcessors": [],
                    "postProcessors": [],
                    "application": {
                        "name": "python",
                        "shortName": "py",
                        "summary": "Python Script",
                        "build": "GNU",
                        "isDefault": true,
                        "version": "3.10.13",
                        "schemaVersion": "2022.8.16"
                    },
                    "executable": {
                        "isDefault": true,
                        "monitors": [
                            "standard_output"
                        ],
                        "name": "python",
                        "schemaVersion": "2022.8.16"
                    },
                    "flavor": {
                        "applicationName": "python",
                        "executableName": "python",
                        "input": [
                            {
                                "name": "script.py",
                                "templateName": "plot_wavefunction.py"
                            },
                            {
                                "name": "requirements.txt",
                                "templateName": "requirements_plot_wavefunction.txt"
                            }
                        ],
                        "monitors": [
                            "standard_output"
                        ],
                        "results": [
                            "potential_profile",
                            "file_content"
                        ],
                        "name": "plot_wavefunction",
                        "schemaVersion": "2022.8.16",
                        "isDefault": false
                    },
                    "status": "idle",
                    "statusTrack": [],
                    "tags": [],
                    "input": [
                        {
                            "applicationName": "python",
                            "content": "# ---------------------------------------------------------------- #\n#  Generate wavefunction plot from pp.x output                      #\n#  Outputs potential_profile JSON to STDOUT for platform rendering  #\n#  Also saves static PNG as fallback                                #\n# ---------------------------------------------------------------- #\n\nimport json\n\nimport matplotlib\nimport numpy as np\n\nmatplotlib.use('Agg')  # Non-interactive backend\nimport matplotlib.pyplot as plt\n\n# Load wavefunction data from pp.x output\ndata = np.loadtxt('wf_r.dat')\nz = data[:, 0]\npsi_r = data[:, 1]\n\n# Calculate wavefunction amplitude\npsi_amplitude = np.abs(psi_r)\n\n# Create static PNG plot\nfig, ax = plt.subplots(figsize=(10, 6))\nax.plot(z, psi_amplitude, 'b-', linewidth=2)\nax.set_xlabel('Position z (Å)', fontsize=12)\nax.set_ylabel('Wavefunction amplitude |ψ| (a.u.)', fontsize=12)\nax.set_title('Wavefunction along z-axis', fontsize=14)\nax.grid(True, alpha=0.3)\nplt.tight_layout()\nplt.savefig('wf_r.png', dpi=150, bbox_inches='tight')\nplt.close()\n\n# Create potential_profile JSON for platform rendering\nwavefunction_data = {\n    \"name\": \"potential_profile\",\n    \"xAxis\": {\n        \"label\": \"Position\",\n        \"units\": \"angstrom\"\n    },\n    \"xDataArray\": z.tolist(),\n    \"yAxis\": {\n        \"label\": \"Wavefunction Amplitude\",\n        \"units\": \"a.u.\"\n    },\n    \"yDataSeries\": [psi_amplitude.tolist()]\n}\n\n# Print JSON to STDOUT (will be captured as potential_profile result)\nprint(json.dumps(wavefunction_data, indent=2))\n",
                            "contextProviders": [],
                            "executableName": "python",
                            "name": "script.py",
                            "rendered": "# ---------------------------------------------------------------- #\n#  Generate wavefunction plot from pp.x output                      #\n#  Outputs potential_profile JSON to STDOUT for platform rendering  #\n#  Also saves static PNG as fallback                                #\n# ---------------------------------------------------------------- #\n\nimport json\n\nimport matplotlib\nimport numpy as np\n\nmatplotlib.use('Agg')  # Non-interactive backend\nimport matplotlib.pyplot as plt\n\n# Load wavefunction data from pp.x output\ndata = np.loadtxt('wf_r.dat')\nz = data[:, 0]\npsi_r = data[:, 1]\n\n# Calculate wavefunction amplitude\npsi_amplitude = np.abs(psi_r)\n\n# Create static PNG plot\nfig, ax = plt.subplots(figsize=(10, 6))\nax.plot(z, psi_amplitude, 'b-', linewidth=2)\nax.set_xlabel('Position z (Å)', fontsize=12)\nax.set_ylabel('Wavefunction amplitude |ψ| (a.u.)', fontsize=12)\nax.set_title('Wavefunction along z-axis', fontsize=14)\nax.grid(True, alpha=0.3)\nplt.tight_layout()\nplt.savefig('wf_r.png', dpi=150, bbox_inches='tight')\nplt.close()\n\n# Create potential_profile JSON for platform rendering\nwavefunction_data = {\n    \"name\": \"potential_profile\",\n    \"xAxis\": {\n        \"label\": \"Position\",\n        \"units\": \"angstrom\"\n    },\n    \"xDataArray\": z.tolist(),\n    \"yAxis\": {\n        \"label\": \"Wavefunction Amplitude\",\n        \"units\": \"a.u.\"\n    },\n    \"yDataSeries\": [psi_amplitude.tolist()]\n}\n\n# Print JSON to STDOUT (will be captured as potential_profile result)\nprint(json.dumps(wavefunction_data, indent=2))\n",
                            "schemaVersion": "2022.8.16"
                        },
                        {
                            "applicationName": "python",
                            "content": "# ------------------------------------------------------------------ #\n#                                                                    #\n#  Python package requirements for plot_wavefunction unit            #\n#                                                                    #\n# ------------------------------------------------------------------ #\n\nnumpy<2\nmatplotlib\n",
                            "contextProviders": [],
                            "executableName": "python",
                            "name": "requirements.txt",
                            "rendered": "# ------------------------------------------------------------------ #\n#                                                                    #\n#  Python package requirements for plot_wavefunction unit            #\n#                                                                    #\n# ------------------------------------------------------------------ #\n\nnumpy<2\nmatplotlib\n",
                            "schemaVersion": "2022.8.16"
                        }
                    ]
                }
            ]
        }
    ],
    "units": [
        {
            "name": "Total Energy with Bands",
            "type": "subworkflow",
            "_id": "109ac366-8f6d-56d5-9b45-6f665f13a511",
            "status": "idle",
            "statusTrack": [],
            "flowchartId": "84f1102e-5cbf-54ce-bc09-48bced817f9f",
            "tags": [],
            "head": true,
            "next": "8c691f3c-556e-5f4c-8db4-46d6f08d6c9b"
        },
        {
            "name": "Extract Bands Near Fermi",
            "type": "subworkflow",
            "_id": "1bb75a6a-4c8c-5336-a24c-1963e83825bc",
            "status": "idle",
            "statusTrack": [],
            "flowchartId": "8c691f3c-556e-5f4c-8db4-46d6f08d6c9b",
            "tags": [],
            "head": false,
            "next": "b26bb41f-0237-51db-9e59-16c157c8dd03"
        },
        {
            "name": "PP Wavefunction",
            "type": "subworkflow",
            "_id": "7edc20aa-d533-57d8-b8a0-1e504ceb19fd",
            "status": "idle",
            "statusTrack": [],
            "flowchartId": "b26bb41f-0237-51db-9e59-16c157c8dd03",
            "tags": [],
            "head": false,
            "next": "4ce49281-e731-550e-af66-6d2408db8237"
        },
        {
            "name": "Plot Wavefunction",
            "type": "subworkflow",
            "_id": "e4ec581f-1cb3-5036-b698-999a96711559",
            "status": "idle",
            "statusTrack": [],
            "flowchartId": "4ce49281-e731-550e-af66-6d2408db8237",
            "tags": [],
            "head": false
        }
    ],
    "properties": [
        "atomic_forces",
        "band_structure",
        "fermi_energy",
        "pressure",
        "stress_tensor",
        "total_energy",
        "total_energy_contributions",
        "total_force"
    ],
    "_id": "9f523214-605f-5eed-8b58-2e2d8fbc18e3",
    "workflows": [],
    "schemaVersion": "2022.8.16",
    "isDefault": false,
    "tags": [
        "wfn_plot"
    ],
    "application": {
        "name": "espresso"
    }
}
