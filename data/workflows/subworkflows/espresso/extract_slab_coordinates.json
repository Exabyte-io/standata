{
    "isMultiMaterial": true,
    "_id": "d89c776d-3b76-54d6-9f9a-f9e244b1e9e2",
    "name": "Extract Slab Coordinates",
    "application": {
        "name": "espresso"
    },
    "properties": [],
    "model": {
        "type": "unknown",
        "subtype": "unknown",
        "method": {
            "type": "unknown",
            "subtype": "unknown",
            "data": {}
        }
    },
    "units": [
        {
            "name": "Set Material Index",
            "type": "assignment",
            "operand": "MATERIAL_INDEX",
            "value": "0",
            "input": [],
            "status": "idle",
            "statusTrack": [],
            "flowchartId": "2d360607-c739-54ad-97a0-8a83f0971f2c",
            "tags": [],
            "head": true,
            "next": "python-extract-coords",
            "application": {
                "name": "python",
                "shortName": "py",
                "summary": "Python Script",
                "build": "GNU",
                "isDefault": true,
                "version": "3.10.13",
                "schemaVersion": "2022.8.16"
            }
        },
        {
            "type": "execution",
            "name": "Extract Z-Coordinates from Material",
            "head": false,
            "results": [],
            "monitors": [
                {
                    "name": "standard_output"
                }
            ],
            "flowchartId": "python-extract-coords",
            "preProcessors": [],
            "postProcessors": [],
            "application": {
                "name": "python",
                "shortName": "py",
                "summary": "Python Script",
                "build": "GNU",
                "isDefault": true,
                "version": "3.10.13",
                "schemaVersion": "2022.8.16"
            },
            "executable": {
                "isDefault": true,
                "monitors": [
                    "standard_output"
                ],
                "name": "python",
                "schemaVersion": "2022.8.16"
            },
            "flavor": {
                "applicationName": "python",
                "executableName": "python",
                "input": [
                    {
                        "name": "extract_slab_coordinates.py",
                        "templateName": "extract_slab_coordinates.py"
                    },
                    {
                        "name": "requirements.txt",
                        "templateName": "requirements_with_made.txt"
                    }
                ],
                "monitors": [
                    "standard_output"
                ],
                "name": "generic:processing:extract_slab_coordinates",
                "schemaVersion": "2022.8.16",
                "isDefault": false
            },
            "status": "idle",
            "statusTrack": [],
            "tags": [],
            "input": [
                {
                    "applicationName": "python",
                    "content": "#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n\"\"\"\nExtract z-coordinate boundaries from materials for polar VBO calculation.\n\nReads structure from pw_scf.out file using ASE and extracts z-coordinates.\n\"\"\"\nimport json\nimport os\n\nimport numpy as np\nimport ase.io\nfrom mat3ra.made.material import Material\nfrom mat3ra.made.tools.convert import from_ase\n\n# Material index: 0=Interface, 1=Left, 2=Right\n# Access from subworkflowContext (set by assignment unit in workflow)\n{% if subworkflowContext.MATERIAL_INDEX is defined %}\nmaterial_index = int({{ subworkflowContext.MATERIAL_INDEX }})\n{% else %}\nmaterial_index = 0\n{% endif %}\n\n# Read structure from pw_scf.out (generated by previous pw_scf calculation)\n# Files are named: pw_scf.out (index 0), pw_scf.out-1 (index 1), pw_scf.out-2 (index 2)\nif material_index == 0:\n    pw_scf_output = \"./pw_scf.out\"\nelse:\n    pw_scf_output = f\"./pw_scf.out-{material_index}\"\n\nif not os.path.exists(pw_scf_output):\n    raise FileNotFoundError(f\"Required file '{pw_scf_output}' not found. Cannot extract slab coordinates.\")\n\n# Read atomic structure from espresso output\natoms = ase.io.read(pw_scf_output, format=\"espresso-out\")\n\n# Convert ASE Atoms to Material using mat3ra-made\nmaterial = Material.create(from_ase(atoms))\n\n# Extract z-coordinates\ncoordinates = material.basis.coordinates\nz_coords_frac = np.array(coordinates.get_values_along_axis(axis=\"z\"))\n\n# Convert to Cartesian (Angstroms)\nc_length = material.lattice.c\nz_coords_angstrom = z_coords_frac * c_length\n\n# Extract z-range for this material\nz_min = np.min(z_coords_angstrom)\nz_max = np.max(z_coords_angstrom)\n\n# Return just this material's coordinates\n# The workflow will map them to slab1 (for Left) or slab2 (for Right)\nresult = {\n    \"z_min\": float(z_min),\n    \"z_max\": float(z_max),\n    \"material_index\": material_index,\n}\n\nprint(json.dumps(result, indent=4))\n",
                    "contextProviders": [],
                    "executableName": "python",
                    "name": "extract_slab_coordinates.py",
                    "rendered": "#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n\"\"\"\nExtract z-coordinate boundaries from materials for polar VBO calculation.\n\nReads structure from pw_scf.out file using ASE and extracts z-coordinates.\n\"\"\"\nimport json\nimport os\n\nimport numpy as np\nimport ase.io\nfrom mat3ra.made.material import Material\nfrom mat3ra.made.tools.convert import from_ase\n\n# Material index: 0=Interface, 1=Left, 2=Right\n# Access from subworkflowContext (set by assignment unit in workflow)\n\nmaterial_index = 0\n\n\n# Read structure from pw_scf.out (generated by previous pw_scf calculation)\n# Files are named: pw_scf.out (index 0), pw_scf.out-1 (index 1), pw_scf.out-2 (index 2)\nif material_index == 0:\n    pw_scf_output = \"./pw_scf.out\"\nelse:\n    pw_scf_output = f\"./pw_scf.out-{material_index}\"\n\nif not os.path.exists(pw_scf_output):\n    raise FileNotFoundError(f\"Required file '{pw_scf_output}' not found. Cannot extract slab coordinates.\")\n\n# Read atomic structure from espresso output\natoms = ase.io.read(pw_scf_output, format=\"espresso-out\")\n\n# Convert ASE Atoms to Material using mat3ra-made\nmaterial = Material.create(from_ase(atoms))\n\n# Extract z-coordinates\ncoordinates = material.basis.coordinates\nz_coords_frac = np.array(coordinates.get_values_along_axis(axis=\"z\"))\n\n# Convert to Cartesian (Angstroms)\nc_length = material.lattice.c\nz_coords_angstrom = z_coords_frac * c_length\n\n# Extract z-range for this material\nz_min = np.min(z_coords_angstrom)\nz_max = np.max(z_coords_angstrom)\n\n# Return just this material's coordinates\n# The workflow will map them to slab1 (for Left) or slab2 (for Right)\nresult = {\n    \"z_min\": float(z_min),\n    \"z_max\": float(z_max),\n    \"material_index\": material_index,\n}\n\nprint(json.dumps(result, indent=4))\n",
                    "schemaVersion": "2022.8.16"
                },
                {
                    "applicationName": "python",
                    "content": "# ----------------------------------------------------------------- #\n#                                                                   #\n#  Example Python package requirements for the Mat3ra platform      #\n#                                                                   #\n#  Will be used as follows:                                         #\n#                                                                   #\n#    1. A runtime directory for this calculation is created         #\n#    2. This list is used to populate a Python virtual environment  #\n#    3. The virtual environment is activated                        #\n#    4. The Python process running the script included within this  #\n#       job is started                                              #\n#                                                                   #\n#  For more information visit:                                      #\n#   - https://pip.pypa.io/en/stable/reference/pip_install           #\n#   - https://virtualenv.pypa.io/en/stable/                         #\n#                                                                   #\n# ----------------------------------------------------------------- #\n\n\nmunch==2.5.0\nnumpy>=1.19.5\nscipy>=1.5.4\nmatplotlib>=3.0.0\nmat3ra-made[tools]>=2024.11.12.0\n\n",
                    "contextProviders": [],
                    "executableName": "python",
                    "name": "requirements.txt",
                    "rendered": "# ----------------------------------------------------------------- #\n#                                                                   #\n#  Example Python package requirements for the Mat3ra platform      #\n#                                                                   #\n#  Will be used as follows:                                         #\n#                                                                   #\n#    1. A runtime directory for this calculation is created         #\n#    2. This list is used to populate a Python virtual environment  #\n#    3. The virtual environment is activated                        #\n#    4. The Python process running the script included within this  #\n#       job is started                                              #\n#                                                                   #\n#  For more information visit:                                      #\n#   - https://pip.pypa.io/en/stable/reference/pip_install           #\n#   - https://virtualenv.pypa.io/en/stable/                         #\n#                                                                   #\n# ----------------------------------------------------------------- #\n\n\nmunch==2.5.0\nnumpy>=1.19.5\nscipy>=1.5.4\nmatplotlib>=3.0.0\nmat3ra-made[tools]>=2024.11.12.0\n\n",
                    "schemaVersion": "2022.8.16"
                }
            ],
            "next": "83a497a3-98ef-56c6-8645-2ed81aea47df"
        },
        {
            "name": "Parse Coordinate Results",
            "type": "assignment",
            "operand": "COORDS",
            "value": "json.loads(STDOUT)",
            "input": [
                {
                    "name": "STDOUT",
                    "scope": "python-extract-coords"
                }
            ],
            "status": "idle",
            "statusTrack": [],
            "flowchartId": "83a497a3-98ef-56c6-8645-2ed81aea47df",
            "tags": [],
            "head": false,
            "next": "2dd3de29-111a-5315-bc0c-5cbc45fab7d7",
            "application": {
                "name": "python",
                "shortName": "py",
                "summary": "Python Script",
                "build": "GNU",
                "isDefault": true,
                "version": "3.10.13",
                "schemaVersion": "2022.8.16"
            }
        },
        {
            "name": "Set Slab1 Min Coordinate",
            "type": "assignment",
            "operand": "slab1_min",
            "value": "COORDS['z_min']",
            "input": [],
            "status": "idle",
            "statusTrack": [],
            "flowchartId": "2dd3de29-111a-5315-bc0c-5cbc45fab7d7",
            "tags": [],
            "head": false,
            "next": "9052b78f-56ab-587f-a5e0-5cd15ff81a61",
            "application": {
                "name": "python",
                "shortName": "py",
                "summary": "Python Script",
                "build": "GNU",
                "isDefault": true,
                "version": "3.10.13",
                "schemaVersion": "2022.8.16"
            }
        },
        {
            "name": "Set Slab1 Max Coordinate",
            "type": "assignment",
            "operand": "slab1_max",
            "value": "COORDS['z_max']",
            "input": [],
            "status": "idle",
            "statusTrack": [],
            "flowchartId": "9052b78f-56ab-587f-a5e0-5cd15ff81a61",
            "tags": [],
            "head": false,
            "next": "3dc86d2e-680e-561c-a9f3-f58144656567",
            "application": {
                "name": "python",
                "shortName": "py",
                "summary": "Python Script",
                "build": "GNU",
                "isDefault": true,
                "version": "3.10.13",
                "schemaVersion": "2022.8.16"
            }
        },
        {
            "name": "Set Slab2 Min Coordinate",
            "type": "assignment",
            "operand": "slab2_min",
            "value": "COORDS['z_min']",
            "input": [],
            "status": "idle",
            "statusTrack": [],
            "flowchartId": "3dc86d2e-680e-561c-a9f3-f58144656567",
            "tags": [],
            "head": false,
            "next": "9a3c8610-67ee-5954-aa9d-c9f6fe0b9c29",
            "application": {
                "name": "python",
                "shortName": "py",
                "summary": "Python Script",
                "build": "GNU",
                "isDefault": true,
                "version": "3.10.13",
                "schemaVersion": "2022.8.16"
            }
        },
        {
            "name": "Set Slab2 Max Coordinate",
            "type": "assignment",
            "operand": "slab2_max",
            "value": "COORDS['z_max']",
            "input": [],
            "status": "idle",
            "statusTrack": [],
            "flowchartId": "9a3c8610-67ee-5954-aa9d-c9f6fe0b9c29",
            "tags": [],
            "head": false,
            "application": {
                "name": "python",
                "shortName": "py",
                "summary": "Python Script",
                "build": "GNU",
                "isDefault": true,
                "version": "3.10.13",
                "schemaVersion": "2022.8.16"
            }
        }
    ]
}
